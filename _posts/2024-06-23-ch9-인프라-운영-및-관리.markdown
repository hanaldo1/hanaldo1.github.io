---
layout: post
title: "[ìš°ë¨¼ì‡ì¸  ìŠ¤í„°ë””] í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC - Chapter 09. ì¸í”„ë¼ ìš´ì˜ ë° ê´€ë¦¬"
date: 2024-06-23 00:00:00 +0900
categories: [blog]
---

```
ğŸ’¡ í…Œë¼í¼ìœ¼ë¡œ êµ¬ì„±ëœ ì¸í”„ë¼ í™˜ê²½ì€ ì§€ì†ì ìœ¼ë¡œ ì•ˆì •ì„±ê³¼ ì •ìƒ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ì‘ì—…ì„ í•´ì£¼ì–´ì•¼ í•¨.
í•´ë‹¹ ì±•í„°ì—ì„œëŠ” ì´ë¥¼ ìœ„í•œ ë°©ë²• ë“¤ì„ ì•Œì•„ë³´ê³ ì í•¨.
```

# 9.1. ë°°í¬ ë‹¨ìœ„ ê´€ë¦¬
ë³€ê²½ì„ ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ í…Œë¼í¼ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  ê¸°ì¡´ì˜ State ì™€ ë¹„êµí•¨ìœ¼ë¡œì¨ ì¼ê´€ì„±ê³¼ ì•ˆì •ì„±ì„ ì œê³µí•˜ì§€ë§Œ, **ì§€ì†ì ì¸ ë³€ê²½ ìš”êµ¬ì‚¬í•­**ê³¼ **State ê°€ ì‹¤ì œ ì¸í”„ë¼ ìƒíƒœì™€ ë‹¤ë¥¸ ê²½ìš°**ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.

- Ex. AWS Security Group ì˜ Rule, í…Œë¼í¼ìœ¼ë¡œ ê´€ë¦¬ë˜ë˜ ë¦¬ì†ŒìŠ¤ì˜ ë§¤ë‰´ì–¼(manual) ì¡°ì‘

<!-- 9.1.1. -->
{% capture title_911 %}
## â–¼ 9.1.1. ì½”ë“œì˜ ì¬êµ¬ì„±ê³¼ State ì£¼ì†Œ ì´ë™
{% endcapture %}

{% capture content_911 %}
> ğŸ™Œ í…Œë¼í¼ì—ì„œ ì¢‹ì€ ê¸°ëŠ¥ì´ë¼ê³  ìƒê°í•˜ëŠ” ê²ƒ ì¤‘ í•˜ë‚˜ 

ë¦¬ì†ŒìŠ¤ê°€ ë°°í¬ëœ ìƒíƒœì—ì„œ ë¦¬ì†ŒìŠ¤/ëª¨ë“ˆ/ë°ì´í„° ë¸”ë¡ì˜ **ì´ë¦„**ì´ ë³€ê²½ë˜ë©´ í…Œë¼í¼ ìƒì—ì„œì˜ ì£¼ì†Œê°€ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±í•˜ë ¤ê³  í•¨

â†’ êµ¬ì„±ì´ ë³€ê²½ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìƒˆë¡œ ìƒì„±í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— State ìƒì˜ ì£¼ì†Œë¥¼ ë³€ê²½ í•´ì¤˜ì•¼ í•˜ê³  ì´ë•Œ **terraform state** ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©

- `terraform state list`: í˜„ì¬ ìƒíƒœ ê¸°ì¤€ ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ í™•ì¸
    - -id ì˜µì…˜ì„ í†µí•´ ì‹¤ì œ ID ê°’(ex. ì¸ìŠ¤í„´ìŠ¤ id) ì„ í™•ì¸ í•  ìˆ˜ ìˆìŒ
- `terraform state mv <source> <destination>` : State ìƒì˜ ë¦¬ì†ŒìŠ¤ ì£¼ì†Œë¥¼ ìƒˆë¡œìš´ ì£¼ì†Œë¡œ ë³€ê²½

### EX. ë¦¬ì†ŒìŠ¤ ë¸”ë¡ ì´ë¦„ ë³€ê²½
ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì • í›„ plan ì„ ì‹¤í–‰í•´ë³´ë©´ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ëŠ” ì œê±°í•˜ê³  ìƒˆ ë¦¬ì†ŒìŠ¤ê°€ ì¶”ê°€ë˜ëŠ” ê³„íšì´ ì¶œë ¥ë¨

```
# ê¸°ì¡´ ì½”ë“œ
resource "null_resource" "configure-cat-app" { ... }

# ë³€ê²½ ì½”ë“œ
resource "null_resource" "configure_cat_app" { ... }
```

{% capture title_9111 %}
#### â–¼ ğŸ’» terraform plan ê²°ê³¼
{% endcapture %}

{% capture content_9111 %}  
```
Terraform will perform the following actions:

  # null_resource.configure-cat-app will be destroyed
  # (because null_resource.configure-cat-app is not in configuration)
  - resource "null_resource" "configure-cat-app" {
      - id = "8477361916687168569" -> null
    }

  # null_resource.configure_cat_app will be created
  + resource "null_resource" "configure_cat_app" {
      + id = (known after apply)
    }

Plan: 1 to add, 0 to change, 1 to destroy.
```
{% endcapture %}

{% assign markdown_title_9111 = title_9111 | markdownify %}
{% assign markdown_content_9111 = content_9111 | markdownify %}

{% include toggle.html
  title=markdown_title_9111
  content=markdown_content_9111
%}

### terraform state mv
ìƒˆë¡œìš´ ì£¼ì†Œë¡œ ë³€ê²½í•œ í›„, plan ì‹œ ë³€ê²½ ì‚¬í•­ì´ ì—†ë‹¤ëŠ” ê³„íšì„ í™•ì¸ í•  ìˆ˜ ìˆìŒ

```
$ terraform state mv 'null_resource.configure-cat-app' 'null_resource.configure_cat_app'
Move "null_resource.configure-cat-app" to "null_resource.configure_cat_app"
Successfully moved 1 object(s).

$ terraform plan
No changes. Your infrastructure matches the configuration.
```

{% capture title_sub2 %}
### â–¼ ì—°ìŠµ ë¬¸ì œ
{% endcapture %}

{% capture content_sub2 %}
> 1. count ì— ì ìš©ë˜ëŠ” ê°œìˆ˜ëŠ” ec2_count ì´ë¦„ì˜ ë³€ìˆ˜ë¡œ ê´€ë¦¬
> 2. ì´ˆê¸° countëŠ” 1ì´ê³  1ë³´ë‹¤ ì‘ì„ ìˆ˜ ì—†ìŒ
> 3. ì¶œë ¥ë˜ëŠ” url ë° ip ê°’ì—ëŠ” [`http://ì ‘ë‘ì‚¬`](http://ì ‘ë‘ì‚¬) í•„ìš”


ğŸ“ ì½”ë“œëŠ” p.301~302 ì°¸ê³ 

ğŸ“ [ì‹¤ìŠµ ì‹œ ì±…ê³¼ ë‹¬ëë˜ ì ] state mv ì—†ì´ë„ apply ì‹œ ë³„ë‹¤ë¥¸ ë³€ê²½ì‚¬í•­ ì—†ì´ ì—…ë°ì´íŠ¸ ë˜ì—ˆìŒ
â†’ ë‹¨ìˆœíˆ ë‹¨ì¼ ë¦¬ì†ŒìŠ¤ì—ì„œ index ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ í…Œë¼í¼ì—ì„œ ì•Œì•„ì„œ í•´ì£¼ëŠ” ê±´ì§€?

**terraform apply**
```
$ terraform apply

Terraform will perform the following actions:

  # aws_eip.hashicat has moved to aws_eip.hashicat[0]
    resource "aws_eip" "hashicat" {
        id                       = "eipalloc-0bbcb02bf3d59fef3"
        tags                     = {}
        # (18 unchanged attributes hidden)
    }

  # aws_eip_association.hashicat has moved to aws_eip_association.hashicat[0]
    resource "aws_eip_association" "hashicat" {
        id                   = "eipassoc-0b799a5bfdef4d0b1"
        # (5 unchanged attributes hidden)
    }

  # aws_instance.hashicat has moved to aws_instance.hashicat[0]
    resource "aws_instance" "hashicat" {
        id                                   = "i-0a37872957af91165"
        tags                                 = {
            "Name" = "tf101-hashicat-instance"
        }
        # (39 unchanged attributes hidden)

        # (8 unchanged blocks hidden)
    }

  # null_resource.configure_cat_app has moved to null_resource.configure_cat_app[0]
    resource "null_resource" "configure_cat_app" {
        id = "8477361916687168569"
    }

Plan: 0 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  ~ catapp_ip  = "http://43.201.13.12" -> [
      + "http://43.201.13.12",
    ]
  ~ catapp_url = "http://ec2-43-201-13-12.ap-northeast-2.compute.amazonaws.com" -> [
      + "http://ec2-43-201-13-12.ap-northeast-2.compute.amazonaws.com",
    ]
```
{% endcapture %}

{% assign markdown_title_9112 = title_9112 | markdownify %}
{% assign markdown_content_9112 = content_9112 | markdownify %}

{% include toggle.html
  title=markdown_title_9112
  content=markdown_content_9112
%}

{% endcapture %}

{% assign markdown_title_911 = title_911 | markdownify %}
{% assign markdown_content_911 = content_911 | markdownify %}

{% include toggle.html
  title=markdown_title_911
  content=markdown_content_911
%}


<!-- 9.1.2 -->
{% capture title_912 %}
## â–¼ 9.1.2. ë°°í¬ëœ ë¦¬ì†ŒìŠ¤ì˜ í¸ì°¨ ìˆ˜ì •
{% endcapture %}

{% capture content_912 %}
ë°°í¬ëœ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ì´ ì•„ë‹Œ ë‹¤ë¥¸ ê²½ë¡œ(ex. ì½˜ì†”) ë¥¼ í†µí•´ ë³€ê²½í•œ ê²½ìš° ì‹¤ì œ ì¸í”„ë¼ì™€ State ê°„ì˜ ì°¨ì´ê°€ ë°œìƒí•˜ê³ , ì•„ë˜ ë°©ë²• ì¤‘ í•œê°€ì§€ë¥¼ ì„ íƒí•˜ì—¬ ì¡°ì¹˜í•  ìˆ˜ ìˆìŒ

- ì½”ë“œ êµ¬ì„±ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì¬ í”„ë¡œë¹„ì €ë‹
- State ë¥¼ ì‹¤ì œ ì¸í”„ë¼ì˜ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ í•˜ê³  ì½”ë“œ ìˆ˜ì •

### EX. AWS ì½˜ì†”ì—ì„œ SG ì¸ë°”ìš´ë“œ ê·œì¹™ ìˆ˜ì •
{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/sg_inbound_before.png" caption="[sg ì¸ë°”ìš´ë“œ ìˆ˜ì • ì „]" %}

{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/sg_inbound_after.png" caption="[sg ì¸ë°”ìš´ë“œ ìˆ˜ì • í›„]" %}

ìœ„ì™€ ê°™ì´ ì½˜ì†”ì—ì„œ ì§ì ‘ ë¦¬ì†ŒìŠ¤ë¥¼ ìˆ˜ì •í•˜ê³  terraform plan ì„ ì‹¤í–‰í•˜ë©´, í…Œë¼í¼ì€ ë¦¬ì†ŒìŠ¤(SG)ë¥¼ ì½”ë“œ êµ¬ì„±ìœ¼ë¡œ ë³€ê²½ í•˜ë ¤ëŠ” ê³„íšì„ ì¶œë ¥í•¨. (ì¦‰, ì§ì ‘ ì¶”ê°€ëœ ê·œì¹™ì€ ì œê±°ë˜ëŠ” ê³„íš í‘œì‹œ)

{% capture title_9121 %}
#### â–¼ ğŸ’»Â terraform plan ì¶œë ¥
{% endcapture %}

{% capture content_9121 %}
```
Terraform will perform the following actions:

  # aws_security_group.hashicat will be updated in-place
  ~ resource "aws_security_group" "hashicat" {
        id                     = "sg-06614be8af3897fe4"
      ~ ingress                = [
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 22
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 22
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 443
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 443
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 8080
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 8080
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 80
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 80
                # (1 unchanged attribute hidden)
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 22
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 22
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 443
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 443
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 80
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 80
            },
        ]
        name                   = "tf101-security-group"
        tags                   = {
            "Name" = "tf101-security-group"
        }
        # (8 unchanged attributes hidden)
    }

Plan: 0 to add, 1 to change, 0 to destroy.
```
{% endcapture %}

{% assign markdown_title_9121 = title_9121 | markdownify %}
{% assign markdown_content_9121 = content_9121 | markdownify %}

{% include toggle.html
  title=markdown_title_9121
  content=markdown_content_9121
%}

### terraform refresh, terraform state show

ë§Œì•½ **ì§ì ‘ ìˆ˜ì •í•œ ì‚¬í•­ì„ ìœ ì§€**í•´ì•¼ í•œë‹¤ë©´ refresh ë¥¼ í†µí•´ State ë¥¼ ì‹¤ì œ ì¸í”„ë¼ ìƒíƒœì™€ ë§ì¶°ì£¼ê³  ì½”ë“œ ë˜í•œ ë³€ê²½ëœ ì‚¬í•­ì— ë§ê²Œ ìˆ˜ì •í•´ì¤˜ì•¼ í•¨

- `terraform state show <ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ>` ë¥¼ í†µí•´ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ë³€ê²½ í•´ì•¼í•  ì§€ ì°¸ê³ í•  ìˆ˜ ìˆìŒ

{% capture title_9122 %}
#### â–¼ ğŸ’» terraform state show ì¶œë ¥
{% endcapture %}

{% capture content_9122 %}
```
$ terraform state show aws_security_group.hashicat

# aws_security_group.hashicat:
resource "aws_security_group" "hashicat" {
    arn                    = "arn:aws:ec2:ap-northeast-2:471112597139:security-group/sg-06614be8af3897fe4"
    description            = "Managed by Terraform"
    egress                 = [
        {
            cidr_blocks      = [
                "0.0.0.0/0",
            ]
            description      = null
            from_port        = 0
            ipv6_cidr_blocks = []
            prefix_list_ids  = []
            protocol         = "-1"
            security_groups  = []
            self             = false
            to_port          = 0
        },
    ]
    id                     = "sg-06614be8af3897fe4"
    ingress                = [
        {
            cidr_blocks      = [
                "211.206.2.93/32",
            ]
            description      = null
            from_port        = 22
            ipv6_cidr_blocks = []
            prefix_list_ids  = []
            protocol         = "tcp"
            security_groups  = []
            self             = false
            to_port          = 22
        },
        {
            cidr_blocks      = [
                "211.206.2.93/32",
            ]
            description      = null
            from_port        = 443
            ipv6_cidr_blocks = []
            prefix_list_ids  = []
            protocol         = "tcp"
            security_groups  = []
            self             = false
            to_port          = 443
        },
        {
            cidr_blocks      = [
                "211.206.2.93/32",
            ]
            description      = null
            from_port        = 80
            ipv6_cidr_blocks = []
            prefix_list_ids  = []
            protocol         = "tcp"
            security_groups  = []
            self             = false
            to_port          = 80
        },
    ]
    name                   = "tf101-security-group"
    name_prefix            = null
    owner_id               = "471112597139"
    revoke_rules_on_delete = false
    tags                   = {
        "Name" = "tf101-security-group"
    }
    tags_all               = {
        "Name"        = "tf101-security-group"
        "environment" = "dev"
        "name"        = "tf101-vpc-ap-northeast-2"
    }
    vpc_id                 = "vpc-0edee5b602a392df5"
}
```
{% endcapture %}

{% assign markdown_title_9122 = title_9122 | markdownify %}
{% assign markdown_content_9122 = content_9122 | markdownify %}

{% include toggle.html
  title=markdown_title_9122
  content=markdown_content_9122
%}
    
#### ğŸ“ [ì‹¤ìŠµ ì‹œ ì±…ê³¼ ë‹¬ëë˜ ì ]
- plan ì„ ë¨¼ì € í•˜ë©´ state ì— ì´ë¯¸ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë˜ì–´ ë”°ë¡œ refresh ë¥¼ í•˜ì§€ ì•Šì•„ë„ ë˜ì—ˆìŒ
- refresh ë¥¼ í•˜ë”ë¼ë„ ë³€ê²½ ë‚´ìš©ì´ í„°ë¯¸ë„ì— ì¶œë ¥ ë˜ì§€ëŠ” ì•Šì•˜ìŒ (State íŒŒì¼ì— ë³€ê²½ ì‚¬í•­ì€ ì˜ ë°˜ì˜ë¨)

{% endcapture %}

{% assign markdown_title_912 = title_912 | markdownify %}
{% assign markdown_content_912 = content_912 | markdownify %}

{% include toggle.html
  title=markdown_title_912
  content=markdown_content_912
%}

<!-- 9.1.3. -->
{% capture title_913 %}
## â–¼ 9.1.3. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¶„í• 
{% endcapture %}

{% capture content_913 %}
```
ğŸ™Œ ì‹¤ì œë¡œ ì½”ë“œë¡œì¨ ì¸í”„ë¼ë¥¼ ê´€ë¦¬ í•˜ë‹¤ë³´ë©´, í•˜ë‚˜ì˜ ëª¨ë“ˆì— ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ëŠ˜ì–´ë‚¨ì— ë”°ë¼
ë¶„ë¦¬í•´ì•¼ í•˜ëŠ” í•„ìš”ê°€ ìƒê¸°ê³¤ í•˜ê¸° ë•Œë¬¸ì— ì´ë²ˆ ë‚´ìš©ì„ ì˜ ìˆ™ì§€í•˜ë©´ ë„ì›€ì´ ë§ì´ ë  ê²ƒ ê°™ë‹¤ê³  ìƒê°í•¨
``` 

í…Œë¼í¼ ì½”ë“œ êµ¬ì„± ì‹œ ì¼ë°˜ì ìœ¼ë¡œëŠ” ë‹¨ì¼ ëª¨ë“ˆì—ì„œ ì „ì²´ ë¦¬ì†ŒìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹ í•˜ì§€ë§Œ, **í•„ìš”ì— ë”°ë¼ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬** í•˜ë©° ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ì˜í–¥ì´ ì—†ë„ë¡ **í…Œë¼í¼ ì½”ë“œì™€ State ê°€ ëª¨ë‘ ë¶„ë¦¬ í•´ì•¼ í•¨**

ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬í•  ë•ŒëŠ” **ì•„ë˜ ê¸°ì¤€ì— ë”°ë¼ ë²”ìœ„ë¥¼ ê²°ì •**í•˜ê²Œ ë¨  (ë‹¨ìˆœíˆ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¼ë¦¬ ë¶„ë¦¬ X)

- ì‘ì—…ì ë˜ëŠ” íŒ€ ê°„ R&R
- ë¦¬ì†ŒìŠ¤ ë°°í¬ ë‹¨ìœ„

> ğŸ’¡ ì‹¤ìŠµ ì½”ë“œ: <a href="https://github.com/hanaldo1/its-terraform-study/tree/feature/chapter-09">https://github.com/hanaldo1/its-terraform-study/tree/feature/chapter-09</a>

### **i. ë¡œì»¬ ì‘ì—… í™˜ê²½ êµ¬ì„±**
ê¸°ì¡´ì˜ ë£¨íŠ¸ ëª¨ë“ˆì„ ë¶„ë¦¬í•  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ë§ì¶° ê°ê°ì˜ ë£¨íŠ¸ ëª¨ë“ˆë¡œ ë¶„ë¦¬

- Ex. terraform-all â†’ terraform-network, terraform-compute

### **ii. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì ê·¸ê¸° [optional âš ï¸]**
ë‹¨ìœ„ê°€ í° ì‘ì—…ì„ í•  ë•ŒëŠ” ìµœì‹  ìƒíƒœì—ì„œ ë³€ê²½ì‚¬í•­ ì—†ë„ë¡ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ì ê¸€ ìˆ˜ ìˆìŒ

- ë‹¤ë§Œ ë°±ì—”ë“œê°€ locking ì„ ì§€ì›í•´ì•¼ í•˜ë©°, ì§€ì› ì—¬ë¶€ëŠ” [[**ê³µì‹ ë¬¸ì„œ**](https://developer.hashicorp.com/terraform/language/settings/backends/configuration)] ì—ì„œ í™•ì¸ ê°€ëŠ¥

### iii. State ê°€ì ¸ì˜¤ê¸°/ë³´ë‚´ê¸°
1. TFCì™€ ê°™ì€ ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤ë©´, ë°±ì—”ë“œì— ì €ì¥ëœ State ë¥¼ ë¡œì»¬ì— ë³µì‚¬
    1. `$ terraform state pull > terraform.tfstate`

2. 1ë²ˆì—ì„œ ë°›ì€ State íŒŒì¼ê³¼ í•¨ê»˜ ê¸°ì¡´ ë£¨íŠ¸ ëª¨ë“ˆì˜ ì½”ë“œë¥¼ ë¶„ë¦¬ëœ ê° ë£¨íŠ¸ ëª¨ë“ˆì— ë³µì‚¬
    1. ë°±ì—”ë“œ êµ¬ì„±ì˜ ê²½ìš°, ë¶„ë¦¬ ì‘ì—… ì „ê¹Œì§€ëŠ” ì£¼ì„ ì²˜ë¦¬ í•„ìš”
  
{% capture title_9131 %}
##### â–¼ Ex. ë””ë ‰í† ë¦¬ êµ¬ì¡°
{% endcapture %}

{% capture content_9131 %}
```
.
â”œâ”€â”€ terraform-all
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ terraform.tfstate
â”‚   â”œâ”€â”€ files
â”‚   â”‚   â””â”€â”€ deploy_app.sh
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ variables.tf
â”œâ”€â”€ terraform-compute (NEW)
â”‚   â”œâ”€â”€ terraform.tfstate
â”‚   â”œâ”€â”€ files
â”‚   â”‚   â””â”€â”€ deploy_app.sh
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ variables.tf
â””â”€â”€ terraform-network (NEW)
    â”œâ”€â”€ terraform.tfstate
    â”œâ”€â”€ files
    â”‚   â””â”€â”€ deploy_app.sh
    â”œâ”€â”€ main.tf
    â”œâ”€â”€ outputs.tf
    â”œâ”€â”€ terraform.tfvars (optional)
    â””â”€â”€ variables.tf
```
{% endcapture %}

  {% assign markdown_title_9131 = title_9131 | markdownify %}
  {% assign markdown_content_9131 = content_9131 | markdownify %}

  {% include toggle.html
    title=markdown_title_9131
    content=markdown_content_9131
  %}

### iv. ë¶„ë¦¬ ë²”ìœ„ì— ë”°ë¼ ì½”ë“œ ìˆ˜ì • [ë°˜ë³µ]
ê¸°ì¡´ ì½”ë“œì—ì„œ í•´ë‹¹ ëª¨ë“ˆì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë§Œ ë‚¨ê¸°ê³  ì œê±° (+ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” input, output ë³€ìˆ˜)

### v. State ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ ì‚­ì œ [ë°˜ë³µ]
1. ì½”ë“œì—ì„œ ì œê±°í•œ ë¦¬ì†ŒìŠ¤ëŠ” State ìƒì—ì„œë„ ì œê±° (â†’ í•´ë‹¹ ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ ê´€ë¦¬ X)
    
    Ex. `terraform state rm <ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ>`
      
    ```
    $ terraform state rm 'null_resource.configure_cat_app[0]'
    $ terraform state rm 'aws_eip_association.hashicat[0]'
    $ terraform state rm 'aws_eip.hashicat[0]'
    $ terraform state rm 'aws_eip.hashicat[0]'
    $ terraform state rm 'aws_instance.hashicat[0]'
    $ terraform state rm 'data.aws_ami.ubuntu'
    $ terraform state rm 'aws_key_pair.hashicat'
    $ terraform state rm 'tls_private_key.hashicat'
    ```

2. plan ì„ í†µí•´ ë³€ê²½ ì‚¬í•­ì´ ì—†ëŠ”ì§€ í™•ì¸ í›„, apply ë¡œ output ê°±ì‹ 

3. [í•„ìš” ì‹œ] ë¡œì»¬ State ë¥¼ ë°±ì—”ë“œë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
    1. ë°±ì—”ë“œ êµ¬ì„± ì£¼ì„ í•´ì œ í›„, `terraform init` ì‹¤í–‰
    2. ë˜ëŠ” init ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì—¬ë¶€ì— â€˜noâ€™ ë¥¼ ì…ë ¥í•˜ê³ , `terraform state push` ë¥¼ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

### **vi. remote_state í™œìš©**
ë§Œì•½ ë‹¤ë¥¸ ëª¨ë“ˆë¡œ ë¶„ë¦¬ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¸ì¡°í•´ì•¼ í•œë‹¤ë©´, í•„ìš”í•œ ê°’ì„ output ìœ¼ë¡œ ë‚´ë³´ë‚´ê³ `terraform_remote_state` ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì°¸ì¡°

[TFC ì‚¬ìš© ì‹œ] ë‹¤ë¥¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ Remote state sharing ì„¤ì • ì¶”ê°€ í•„ìš”
{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/tfc_remote_state_sharing.png" caption="[TFC Remote state sharing ì„¤ì •]" %}

<br>
- ì˜ˆì‹œ 1) network ë£¨íŠ¸ ëª¨ë“ˆ - `output` ì¶”ê°€
  
    ```
    output "subnet_id" {
      value = aws_subnet.hashicat.id
    }
    
    output "sg_id" {
      value = aws_security_group.hashicat.id
    }
    ```
    
- ì˜ˆì‹œ 2) compute ë£¨íŠ¸ ëª¨ë“ˆ - `terraform_remote_state` ì‚¬ìš©
    - ì°¸ì¡° ë°©ë²•: `data.terraform_remote_state.<ì´ë¦„>.outputs.<ì´ë¦„>`

    ```
    data "terraform_remote_state" "network" {
      backend = "remote"
    
      config = {
        organization = "hanaldo-tf"
        hostname = "app.terraform.io"
        workspaces = {
          name = "terraform-network"
        }
      }
    }
    
    resource "aws_instance" "hashicat" {
    	...
      subnet_id = data.terraform_remote_state.network.outputs.subnet_id
      vpc_security_group_ids = [data.terraform_remote_state.network.outputs.sg_id]
    }
    ```
{% endcapture %}

{% assign markdown_title_913 = title_913 | markdownify %}
{% assign markdown_content_913 = content_913 | markdownify %}

{% include toggle.html
  title=markdown_title_913
  content=markdown_content_913
%}


<!-- 9.1.4. -->
{% capture title_914 %}
## â–¼ 9.1.4. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë³‘í•©
{% endcapture %}

{% capture content_914 %}
ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë³‘í•© ì‹œì—ëŠ” ì½”ë“œ ë¶„í• ê³¼ State ë³µì œ ë° ì‚­ì œë¥¼ ë°˜ëŒ€ë¡œ ì§„í–‰ (â†’ ì¦‰, ì½”ë“œ ë° State ë³‘í•©)

  1. ë¶„ë¦¬í–ˆë˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë³‘í•©í•  ë£¨íŠ¸ ëª¨ë“ˆ ìƒì„±
  2. ë³‘í•©í•  ë£¨íŠ¸ ëª¨ë“ˆì— ë¶„ë¦¬ ë˜ì–´ìˆë˜ ì½”ë“œ ë³‘í•©
  3. ê° ë¶„ë¦¬ëœ ëª¨ë“ˆì˜ ë°±ì—”ë“œì— ì €ì¥ëœ State ë¥¼ ë¡œì»¬ì— ê°€ì ¸ì˜¤ê³ , ë³‘í•©í•  ë£¨íŠ¸ ëª¨ë“ˆ State ì— ë³‘í•©
    1. í•œ ëª¨ë“ˆì˜ terraform.tfstate íŒŒì¼ì„ ë³‘í•© ëª¨ë“ˆì— ë³µì‚¬
    2. terraform state mv ë¥¼ í†µí•´ ë‹¤ë¥¸ ëª¨ë“ˆì˜ State ë³µì‚¬
      1. EX) `terraform state mv -state='<ë¶„ë¦¬ ëª¨ë“ˆ ê²½ë¡œ>/terraform.tfstate' -state-out='<ë³‘í•© ëª¨ë“ˆ ê²½ë¡œ>/terraform.tfstate' '<ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ>' '<ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ>â€™`
{% endcapture %}

{% assign markdown_title_914 = title_914 | markdownify %}
{% assign markdown_content_914 = content_914 | markdownify %}

{% include toggle.html
  title=markdown_title_914
  content=markdown_content_914
%}

<br/>
<!-- ------------------------- -->

# 9.2. ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ìœ¼ë¡œ ê´€ë¦¬

ì´ë¯¸ ìˆ˜ë™ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ì„ í†µí•´ ê´€ë¦¬ë¥¼ í•˜ê²Œ ëœë‹¤ë©´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ **í…Œë¼í¼ State ë¡œ ê°€ì ¸ì˜¨ í›„ (Import)**, ë¦¬ì†ŒìŠ¤ ì •ì˜ì— ë§ê²Œ **ì½”ë“œë¥¼ êµ¬ì„±**í•´ì•¼ í•¨

<!-- 9.2.1. -->
{% capture title_921 %}
## â–¼ 9.2.1. Import
{% endcapture %}

{% capture content_921 %}
terraform import ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ê¸° ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ.

ğŸ“ë‹¨, ë¦¬ì†ŒìŠ¤ ë³„ë¡œ import ì‹œ í•„ìš”í•œ ì •ë³´(ex. AWS EC2 id) ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆê³  import ë¥¼ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ì‘ì—… ì „ **[[Terraform Registry í˜ì´ì§€](https://registry.terraform.io/)] ì—ì„œ í”„ë¡œë°”ì´ë” ë³„ ë¬¸ì„œë¥¼ ì˜ í™•ì¸** í•´ì•¼ í•¨.

### 0. AWS ì½˜ì†”ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•œ ë³´ì•ˆ ê·¸ë£¹
{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/modify_sg_in_console.png" %}

### i. í…Œë¼í¼ êµ¬ì„± ì¤€ë¹„ ë° import

ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì™€ ì—°ê²° ë  ë¦¬ì†ŒìŠ¤ ë¸”ë¡ì„ ì„ ì–¸í•˜ê³ , import ë¥¼ í†µí•´ State ì— í•´ë‹¹ ë¦¬ì†ŒìŠ¤ ì—…ë°ì´íŠ¸

- `terraform import <ë¦¬ì†ŒìŠ¤ ì£¼ì†Œ> <ë¦¬ì†ŒìŠ¤ ID>`

```jsx
resource "aws_security_group" "import_sg" {} # ë¦¬ì†ŒìŠ¤ ë¸”ë¡ë§Œ ì¤€ë¹„
```

```jsx
$ terraform import aws_security_group.import_sg sg-02a88c90deec839a6

aws_security_group.import_sg: Importing from ID "sg-02a88c90deec839a6"...
aws_security_group.import_sg: Import prepared!
  Prepared aws_security_group for import
aws_security_group.import_sg: Refreshing state... [id=sg-02a88c90deec839a6]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.
```

### ii. ë¦¬ì†ŒìŠ¤ ì •ì˜ì— ë§ì¶° í…Œë¼í¼ ì½”ë“œ ìˆ˜ì •

import í•˜ê³  ë‚œ ë’¤ì—ëŠ” ì‹¤ì œ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì— ë§ì¶°ì„œ ì½”ë“œ ë˜í•œ ì‘ì„± (`terraform state show` í™œìš©)

import ê°€ ì™„ë£Œëœ í›„, ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì„ ë³€ê²½ í–ˆì„ ë•Œ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°!

{% capture title_9211 %}
â–¼ ì˜ˆì‹œ) terraform state show
{% endcapture %}

{% capture content_9211 %}
- ë‹¤ë§Œ, state show ì¶œë ¥ ê²°ê³¼ì—ì„œ ë¦¬ì†ŒìŠ¤ ì •ì˜ ì‹œ í•„ìš”í•œ ì¸ìˆ˜ë§Œ ê³¨ë¼ì„œ ì‚¬ìš©í•  í•„ìš” ìˆìŒ
  
  ```jsx
  $ terraform state show aws_security_group.import_sg
  
  resource "aws_security_group" "import_sg" {
      arn         = "arn:aws:ec2:ap-northeast-2:471112597139:security-group/sg-02a88c90deec839a6"
      description = "security group for terraform 101 import practice"
      egress      = []
      id          = "sg-02a88c90deec839a6"
      ingress     = []
      name        = "tf101-import-sg"
      name_prefix = null
      owner_id    = "471112597139"
      tags        = {}
      tags_all    = {}
      vpc_id      = "vpc-03df2fb45155c6b29"
  }
  ```
{% endcapture %}

{% assign markdown_title_9211 = title_9211 | markdownify %}
{% assign markdown_content_9211 = content_9211 | markdownify %}

{% include toggle.html
  title=markdown_title_9211
  content=markdown_content_9211
%}

```jsx
resource "aws_security_group" "import_sg" {
  name        = "tf101-import-sg"
  description = "security group for terraform 101 import practice"
  vpc_id      = "vpc-03df2fb45155c6b29"
  ingress     = []
  egress      = []
}
```

{% endcapture %}

{% assign markdown_title_921 = title_921 | markdownify %}
{% assign markdown_content_921 = content_921 | markdownify %}

{% include toggle.html
  title=markdown_title_921
  content=markdown_content_921
%}

<!-- 9.2.2. -->
{% capture title_922 %}
## â–¼ 9.2.2. Terraformer
{% endcapture %}

{% capture content_922 %}
í…Œë¼í¼ìœ¼ë¡œ ê°€ì ¸ì˜¬ ë¦¬ì†ŒìŠ¤ê°€ ì ë‹¤ë©´ import ë¥¼ í™œìš©í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„í•˜ì§€ë§Œ, ë§Œì•½ ê·¸ ìˆ˜ê°€ ë§ë‹¤ë©´ ì¼ì¼ì´ import í•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆìŒ.

[https://github.com/GoogleCloudPlatform/terraformer](https://github.com/GoogleCloudPlatform/terraformer)

terraformer ì„ ì‚¬ìš©í•˜ë©´ **ì¡°ê±´ì— ë§ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ëª¨ë‘ ì¡°íšŒí•˜ì—¬ í…Œë¼í¼ ì½”ë“œí™” ë° State ë¥¼ êµ¬ì„±** í•  ìˆ˜ ìˆìŒ
{% endcapture %}

{% assign markdown_title_922 = title_922 | markdownify %}
{% assign markdown_content_922 = content_922 | markdownify %}

{% include toggle.html
  title=markdown_title_922
  content=markdown_content_922
%}

<br/>

<!-- ------------------------- -->
# 9.3. ë¦¬íŒ©í† ë§ê³¼ ëª¨ë“ˆí™”

í•œë²ˆ ì‘ì„±í•œ í…Œë¼í¼ ì½”ë“œëŠ” ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼, êµ¬ì„± ë³€ê²½ í•„ìš”ì— ë”°ë¼ ìˆ˜ì • ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì§€ì†ì ìœ¼ë¡œ ê´€ë¦¬ê°€ í•„ìš”í•˜ë©°, ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì„ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš© í•´ì•¼ í•˜ëŠ” ê²½ìš° ëª¨ë“ˆí™”ì˜ í•„ìš”ê°€ ìƒê¹€.

```
ğŸ’¡ ë¦¬íŒ©í† ë§ê³¼ ëª¨ë“ˆí™” ë°©ì‹ì€ í…Œë¼í¼ì„ ì‚¬ìš©í•˜ëŠ” ì¡°ì§ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì—¬ê¸°ì„œëŠ” ì–´ë–¤ ì˜ˆì‹œë“¤ì´ ìˆëŠ”ì§€ ì •ë„ë§Œ ì†Œê°œí•  ì˜ˆì •
```

<!-- 9.3.1. -->
{% capture title_931 %}
## â–¼ 9.3.1. ë¦¬íŒ©í† ë§
{% endcapture %}

{% capture content_931 %}
### i. ë³€ìˆ˜ ì„¤ëª… ì¶”ê°€ ë° validation ì¶”ê°€

input ë³€ìˆ˜ì˜ ê²½ìš° ì‘ì—…ìì— ë”°ë¼ ë‹¤ë¥¸ ê°’ì´ ì…ë ¥ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì˜ë„í•œ ê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ì„¤ëª…ì„ ì¶”ê°€í•˜ê³ , validation ì„¤ì •ì„ í†µí•´ ì˜ë„í•œ ê°’ì´ ì•„ë‹Œ ê²½ìš° ì—ëŸ¬ë¥¼ ë°œìƒ ì‹œí‚´ìœ¼ë¡œì¨ ì˜ˆê¸°ì¹˜ ëª»í•œ ìˆ˜ì • ë“±ì„ ë§‰ìŒ

### ii. count â†’ for_each

ë¦¬ìŠ¤íŠ¸ë¥¼ count ì— ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì¤‘ê°„ ê°’ì´ ì‚­ì œ ë˜ë©´ ì´í›„ ìš”ì†Œë¡œ ì •ì˜ëœ ë¦¬ì†ŒìŠ¤ë„ ì‚­ì œ í›„ ì¬ìƒì„± ë˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì— ì£¼ì˜í•´ì•¼ í•¨. (3.9.1 ì ˆ ì°¸ê³ ) â†’ for_each ê¶Œì¥

### iii. ë¶ˆí•„ìš”í•œ input ë³€ìˆ˜ â†’ local ë³€ìˆ˜

input ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì…ë ¥ ê°’ì— ë”°ë¼ ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì—, ê³ ì •ë˜ê²Œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê°’ì€ local ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ ë˜ë©°, ë°ì´í„° ì†ŒìŠ¤ë¥¼ í™œìš©í•˜ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•ì´ ë  ìˆ˜ ìˆìŒ.

### iv. ì¤‘ë³µ ìƒìˆ˜ ê°’ ëŒ€ì²´

ì¤‘ë³µìœ¼ë¡œ ì‚¬ìš© ë˜ëŠ” ìƒìˆ˜ê°’ (ex. ë¦¬ì†ŒìŠ¤ ì´ë¦„ ì•ì— ë¶™ëŠ” prefix) ì€ ë³€ìˆ˜ë¥¼ í™œìš©í•˜ê±°ë‚˜, cidrsubnet ê³¼ ê°™ì€ [[**í•¨ìˆ˜**](https://developer.hashicorp.com/terraform/language/functions)] ë¥¼ ì‚¬ìš©í•˜ë©´ êµ¬ì„± ì—ëŸ¬ì™€ ê°™ì€ ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŒ.

### v. ë¦¬ì†ŒìŠ¤/ë°ì´í„° ì†ŒìŠ¤ ì´ë¦„ ë‚´ ì¤‘ì²© ì„ ì–¸ ì œê±°

`resource â€œaws_subnetâ€ â€œsub_testâ€` ì²˜ëŸ¼ ì´ë¦„ì— ìœ í˜•ì´ ì¤‘ë³µë˜ì–´ ë“¤ì–´ê°€ëŠ” ê²½ìš°, `resource â€œaws_subnetâ€ â€œtestâ€` ë¡œ ìˆ˜ì •
{% endcapture %}

{% assign markdown_title_931 = title_931 | markdownify %}
{% assign markdown_content_931 = content_931 | markdownify %}

{% include toggle.html
  title=markdown_title_931
  content=markdown_content_931
%}

<!-- 9.3.2-3. -->
{% capture title_9323 %}
## â–¼ 9.3.2-3. ëª¨ë“ˆí™”
{% endcapture %}

{% capture content_9323 %}

ëª¨ë“ˆí™”ëŠ” â€˜ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì— ëŒ€í•œ í…œí”Œë¦¿ì„ ë§Œë“¤ì–´ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©â€™ í•˜ê³ ì í•˜ëŠ” ëª©ì ìœ¼ë¡œ, 1) ë™ì¼ ë¦¬ì†ŒìŠ¤ê°€ ì•„ë‹Œ **ê´€ë¦¬ ëª©ì ì— ë”°ë¼ ë²”ìœ„**ë¥¼ ë‚˜ëˆ„ê³  2) **ë°˜ë³µì  ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•œ êµ¬ì„±ì€ ì œì™¸** í•˜ì—¬ ì§„í–‰í•¨.

- ì…ë ¥ ë³€ìˆ˜ê°€ ë§ìœ¼ë©´ ì´ì— ë”°ë¥¸ ë³€ë™ì„±ì´ ë†’ì•„ì§€ê¸° ë•Œë¬¸ì— ìµœì†Œí™” í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
- ì„ íƒì ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•˜ëŠ” ëª¨ë“ˆ ë˜ëŠ” ë¦¬ì†ŒìŠ¤(ëª¨ë“ˆ ë‚´) ì˜ ê²½ìš°, input ë³€ìˆ˜ë¥¼ í†µí•´ ì œì–´í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±
    - EX) `count = var.enable ? 1: 0`

### ëª¨ë“ˆí™” ê³¼ì •

1. ëª¨ë“ˆí™” ëŒ€ìƒì´ ë˜ëŠ” ë¦¬ì†ŒìŠ¤, ë°ì´í„° ì†ŒìŠ¤ ì½”ë“œ ì´ë™
    1. í•„ìš” ì‹œ, ì½”ë“œ ì˜®ê¸°ëŠ” ê³¼ì • ì¤‘ê°„ì¤‘ê°„ ë¦¬íŒ©í† ë§ ì§„í–‰
2. ëª¨ë“ˆì— í•„ìš”í•œ input ë³€ìˆ˜ ë° ë‚´ë³´ë‚¼ output ë³€ìˆ˜ (ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì°¸ì¡° í•„ìš” ê°’) ì •ì˜
3. ë£¨íŠ¸ ëª¨ë“ˆì— ëª¨ë“ˆ ì„ ì–¸ (+ ëª¨ë“ˆ input ë³€ìˆ˜ì— ë§ì¶° ì¸ìˆ˜ ì •ì˜)

- ì˜ˆì‹œ) ëª¨ë“ˆí™” êµ¬ì¡°
  
    ```jsx
    â”œâ”€â”€ *.tf
    â”œâ”€â”€ modules
    â”‚   â”œâ”€â”€ common # ë„¤íŠ¸ì›Œí¬(vpc, subnet, sg), í‚¤í˜ì–´ ë“±
    â”‚   â”‚   â”œâ”€â”€ ...
    â”‚   â””â”€â”€ eks
    â”‚   â”‚   â”œâ”€â”€ ...
    â””â”€â”€ terraform.tfvars
    ```
{% endcapture %}

{% assign markdown_title_9323 = title_9323 | markdownify %}
{% assign markdown_content_9323 = content_9323 | markdownify %}

{% include toggle.html
  title=markdown_title_9323
  content=markdown_content_9323
%}

<!-- 9.3.4. -->
{% capture title_934 %}
## â–¼ 9.3.4. ëª¨ë“ˆ ê´€ë¦¬
{% endcapture %}

{% capture content_934 %}
êµ¬ì„±í•œ ëª¨ë“ˆì„ ê³µí†µ í…œí”Œë¦¿ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” VCS íƒœê¹…ì„ ì´ìš©í•˜ê±°ë‚˜ TFC Registry ë¥¼ ì´ìš©

{% capture title_9341 %}
### â–¼ ì˜ˆì‹œ) Github
{% endcapture %}

{% capture content_9341 %}
```jsx
module "vpc" {
  source = "github.com/hanaldo1/its-terraform-study//chapter-09//module-management//vpc?ref=v0.0.1"
  ...
}
```

{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/github_tag.png" caption="[Github íƒœê·¸ ìƒì„±]" %}

ğŸ“Â ì‹¤ì œ ì‹¤ìŠµ ì‹œ `?ref=<ë¸Œëœì¹˜>` ëŠ” ì¸ì‹ì„ ëª»í•˜ê³ , íƒœê·¸ë¥¼ ì‚¬ìš©í•´ì•¼ë§Œ í–ˆìŒ

ğŸ“Â ë§Œì•½ ë ˆí¬ì§€í† ë¦¬ ë‚´ ì„œë¸Œ ë””ë ‰í† ë¦¬ë¡œ ëª¨ë“ˆì„ êµ¬ì„± í–ˆë‹¤ë©´ `//<ë””ë ‰í† ë¦¬>` ë¡œ ì§€ì • ê°€ëŠ¥

- `?ref=<ë¸Œëœì¹˜>` ì—ëŸ¬
  
    ```jsx
    Could not download module "vpc" (main.tf:12) source code from
     "git::https://github.com/hanaldo1/its-terraform-study.git?ref=feature": error downloading
     'https://github.com/hanaldo1/its-terraform-study.git?ref=feature': /opt/homebrew/bin/git exited with 1: error: pathspec
     'feature' did not match any file(s) known to git
    ```
{% endcapture %}

{% assign markdown_title_9341 = title_9341 | markdownify %}
{% assign markdown_content_9341 = content_9341 | markdownify %}

{% include toggle.html
  title=markdown_title_9341
  content=markdown_content_9341
%}

<!-- 9.3.4.2 -->
{% capture title_9342 %}
### â–¼ ì˜ˆì‹œ) TFC
{% endcapture %}

{% capture content_9342 %}
{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/github_release.png" caption="[Github ë¦´ë¦¬ì¦ˆ ìƒì„±]" %}

{% include figure.html src="/assets/images/2024-06-23-ch9-ì¸í”„ë¼-ìš´ì˜-ë°-ê´€ë¦¬/tfc_registry.png" caption="[TFC Registry]" %}

```jsx
module "vpc" {
  source  = "app.terraform.io/hanaldo-tf/module/aws"
  version = "0.0.1"
	...
}
```

ğŸ“Â ë ˆí¬ì§€í† ë¦¬ ì´ë¦„ì€ `terraform-<provider>-<name>` í˜•ì‹ì„ ë”°ë¼ì•¼ë§Œ TFC Registry ì—ì„œ ì—°ë™ ì‹œ ì¸ì‹ì´ ë¨
{% endcapture %}

{% assign markdown_title_9342 = title_9342 | markdownify %}
{% assign markdown_content_9342 = content_9342 | markdownify %}

{% include toggle.html
  title=markdown_title_9342
  content=markdown_content_9342
%}

{% endcapture %}

{% assign markdown_title_934 = title_934 | markdownify %}
{% assign markdown_content_934 = content_934 | markdownify %}

{% include toggle.html
  title=markdown_title_934
  content=markdown_content_934
%}

<br/>
<!-- ------------------- -->

# 9.4. ë¬¸ì„œí™”
í…Œë¼í¼ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ë§ì•„ì§€ê³  ì—¬ëŸ¬ ì‚¬ëŒì´ ì‘ì—… í•¨ì— ë”°ë¼ ì‘ì—…ìì˜ ì˜ë„ì™€ëŠ” ë‹¤ë¥´ê²Œ í•´ì„ë  ìˆ˜ ìˆìŒ.

ì´ë¥¼ ë°©ì§€í•˜ê³ ì **ì‘ì—…ìì˜ ì˜ë„ ë° ì£¼ì˜ ì‚¬í•­ ë“¤ì„ ë¬¸ì„œë¡œ ì‘ì„±**í•˜ì—¬ ê°€ì´ë“œë¥¼ ì œì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.

- **ë£¨íŠ¸ ëª¨ë“ˆ**
    - í”„ë¡œë°”ì´ë” ë²„ì „ ì •ë³´
    - í”„ë¡œë¹„ì €ë‹ ëŒ€ìƒ
    - í•„ìš” ìì‹ ëª¨ë“ˆ ë° ë²„ì „
- **ìì‹ ëª¨ë“ˆ (í…œí”Œë¦¿ ëª¨ë“ˆ)**
    - í•´ë‹¹ ëª¨ë“ˆì„ ì‚¬ìš©(ì‘ì„±) í•˜ëŠ” ë°©ë²•
    - ëª¨ë“ˆ êµ¬ì„± ì‹œ í•„ìš” ë³€ìˆ˜ ë° ì£¼ì˜ ì‚¬í•­
    - ëª¨ë“ˆ ë‚´ ì…ë ¥ ë³€ìˆ˜ì— ë”°ë¥¸ ë³€í™”ê°€ í° ê²½ìš° ì´ì— ëŒ€í•œ ì£¼ì˜ ì‚¬í•­ ë° ì¶”ê°€ ì‚¬ìš©ë²•ë„ ì‘ì„±

<br/>
<!-- ------------------- -->

# 9.5. ê°œë°œ ì›Œí¬í”Œë¡œì™€ ìš´ì˜ ì´ê´€

í…Œë¼í¼ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ê³  ìš´ì˜/ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ”, ì´ë¥¼ ìœ„í•œ ì›Œí¬í”Œë¡œìš° ì„¤ê³„ í•„ìš”

- ì¦‰, í…Œë¼í¼ ì½”ë“œë¥¼ ê°œë°œí•˜ê³  ê²€ì¦í•˜ê³  ì‹¤ì œ ìš´ì˜í™˜ê²½ì— ì ìš© í•˜ê¸°ê¹Œì§€ì˜ ì²´ê³„ì ì¸ ê³¼ì •ì„ ì„¸ìš¸ í•„ìš”ê°€ ìˆìŒ

```
ğŸ’¡ ë‹¤ë§Œ, ì´ ë˜í•œ ì¡°ì§ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì—¬ê¸°ì„œëŠ” ì–´ë–¤ ì˜ˆì‹œë¥¼ ë“¤ì—ˆëŠ”ì§€ ì •ë„ë§Œ ì†Œê°œí•  ì˜ˆì •
```

<!-- 9.5.1 -->
{% capture title_951 %}
## â–¼ 9.5.1. í”„ë¡œì íŠ¸ ê°œë°œ ì›Œí¬í”Œë¡œ
{% endcapture %}

{% capture content_951 %}
ì„œë¹„ìŠ¤ ê°œë°œì„ ìœ„í•œ í”„ë¡œì íŠ¸ ê°œë°œ ì›Œí¬í”Œë¡œì—ì„œ í…Œë¼í¼ ì½”ë“œëŠ” VCS ë¥¼ í†µí•´ ë²„ì „ ê´€ë¦¬

ì´ë•Œ, ë¸Œëœì¹˜ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ í™˜ê²½ì„ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬

- ê°œë°œ: í…Œë¼í¼ ì½”ë“œ ì‘ì„± ë° ìˆ˜ì •ì´ ì¼ì–´ë‚˜ëŠ” ë¸Œëœì¹˜. ì‘ì—…ì ë³„ ë¸Œëœì¹˜ë¥¼ ìƒì„± í›„ PR-merge
- ê²€ìˆ˜: í’ˆì§ˆ ê²€ì¦ì„ ìœ„í•´ ê°œë°œ ë¸Œëœì¹˜ ë³‘í•© â†’ ê²€ìˆ˜ í™˜ê²½ í”„ë¡œë¹„ì €ë‹ (í•´ë‹¹ ë¸Œëœì¹˜ë¶€í„°ëŠ” ì½”ë“œ ìˆ˜ì • X)
- ìš´ì˜: ê²€ìˆ˜ ë¸Œëœì¹˜ ë³‘í•© â†’ ìš´ì˜ í™˜ê²½ í”„ë¡œë¹„ì €ë‹
{% endcapture %}

{% assign markdown_title_951 = title_951 | markdownify %}
{% assign markdown_content_951 = content_951 | markdownify %}

{% include toggle.html
  title=markdown_title_951
  content=markdown_content_951
%}

<!-- 9.5.2 -->
{% capture title_952 %}
## â–¼ 9.5.2. ëª¨ë“ˆ ê°œë°œ ì›Œí¬í”Œë¡œ
{% endcapture %}

{% capture content_952 %}
ëª¨ë“ˆ ê°œë°œ ì›Œí¬í”Œë¡œì—ì„œ ë˜í•œ í…Œë¼í¼ ì½”ë“œëŠ” VCS ë¥¼ í†µí•´ ê´€ë¦¬í•˜ë©°, íƒœê¹…ì„ í†µí•´ ë²„ì „ì„ ë¦´ë¦¬ì¦ˆ í•˜ë©° ì‚¬ìš©

- ì´ë ‡ê²Œ ë¦´ë¦¬ì¦ˆ ëœ ëª¨ë“ˆì„ ì„œë¹„ìŠ¤ ê°œë°œì„ ìœ„í•œ í…Œë¼í¼ ì½”ë“œ ì‘ì„± ì‹œ ì‚¬ìš© (Ex. ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ê°™ì´)
{% endcapture %}

{% assign markdown_title_952 = title_952 | markdownify %}
{% assign markdown_content_952 = content_952 | markdownify %}

{% include toggle.html
  title=markdown_title_952
  content=markdown_content_952
%}

<!-- 9.5.3 -->
{% capture title_953 %}
## â–¼ 9.5.3. ìš´ì˜ì´ê´€ ë° ë³€ê²½ ê´€ë¦¬ì˜ ì˜ˆ
{% endcapture %}

{% capture content_953 %}
### ìš´ì˜ì´ê´€

1. ê°œë°œ ë‹¨ê³„ì—ì„œ êµ¬ì„±í•œ í…Œë¼í¼ ì½”ë“œë¥¼ ìš´ì˜í™˜ê²½ì— ì ìš©í•˜ëŠ” ìš´ì˜ì´ê´€ ì£¼ì²´ ì§€ì •
2. ì„œë¹„ìŠ¤/í”„ë¡œì íŠ¸ ê·œëª¨, ìš´ì˜ ì´ê´€ ëŒ€ìƒ ë“±ì„ ê³ ë ¤í•˜ì—¬ ìš´ì˜ì´ê´€ ì‹œì  ì •ì˜

### ë³€ê²½ ê´€ë¦¬

1. í‘œì¤€ ë³€ê²½ ê´€ë¦¬
    1. ì¼ìƒì ì¸ ë³€ê²½ì‚¬í•­(ex. í—ˆìš© IP ì¶”ê°€, ë¦¬ì†ŒìŠ¤ ì†ì„±) ë“±ì„ ë°˜ì˜í•˜ëŠ” ê²½ìš°
2. **ìˆ˜ë™ ë³€ê²½ ê´€ë¦¬**
    1. ì¥ì• ê°€ ë°œìƒí•˜ì—¬ ê¸´ê¸‰ ìˆ˜ì • í•„ìš”ë¡œ, ë¶€ë“ì´í•˜ê²Œ ì½˜ì†”ì„ í†µí•´ ì½”ë“œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²½ìš°
    2. ì´ì™€ ê°™ì€ ê²½ìš°ê°€ ë°œìƒí•œ ê²½ìš° ì‚¬í›„ ì¡°ì¹˜ê°€ ì¤‘ìš”í•¨
        1. ìˆ˜ë™ìœ¼ë¡œ ë°˜ì˜í•œ ë³€ê²½ì‚¬í•­ ê¸°ë¡
        2. State ì™€ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì˜ í¸ì°¨ ìˆ˜ì • (9.1.2 ì°¸ê³ )
        3. ë³€ê²½ì‚¬í•­ ê³µìœ  ë° í‘œì¤€ ì ìš© ì—¬ë¶€ í™•ì¸
3. ì˜ˆì‹œ) ë³€ê²½ ìš”ì²­ ê´€ë¦¬
    1. ë³€ê²½ ìš”ì²­ ë“±ë¡ ë° ì ‘ìˆ˜
        1. ì‚¬ë‚´ ì—…ë¬´ ê´€ë¦¬ íˆ´ ë“±ì„ í™œìš©í•˜ì—¬ ìš”ì²­ ë° ë‹´ë‹¹ì ìš”ì²­ ë‚´ìš© ê²€í† 
    2. ë³€ê²½ ìŠ¹ì¸ ë° ì ìš©
        1. ë³€ê²½ ì‚¬í•­ í…Œë¼í¼ìœ¼ë¡œ ê°œë°œ ë° PR ì„ í†µí•œ ì½”ë“œ ë¦¬ë·° ì§„í–‰ â†’ í”„ë¡œë¹„ì €ë‹
    3. ë³€ê²½ ì‚¬í•­ ë° ì²˜ë¦¬ í˜„í™© ê³µìœ 
        1. ì‚¬ë‚´ ì—…ë¬´ ê´€ë¦¬ íˆ´ ë° ë©”ì‹ ì €ë¥¼ í†µí•´ ì²˜ë¦¬ ì™„ë£Œ ì—¬ë¶€ ê³µìœ 
{% endcapture %}

{% assign markdown_title_953 = title_953 | markdownify %}
{% assign markdown_content_953 = content_953 | markdownify %}

{% include toggle.html
  title=markdown_title_953
  content=markdown_content_953
%}